# test - FFire PHP Bindings

PHP bindings for the test schema, generated by [FFire](https://github.com/shaban/ffire).

## Requirements

- PHP 7.4 or higher
- FFI extension enabled
- The FFI extension must be enabled in php.ini:

```ini
ffi.enable=true
```

## Installation

### Using Composer

```bash
cd php
composer install
```

## Usage

```php
<?php

require_once 'vendor/autoload.php';

use Test\Message;
use Test\FFireException;

// Decode from binary
$data = file_get_contents('data.bin');

try {
    $msg = Message::decode($data);
    
    // Encode back to binary
    $encoded = $msg->encode();
    
    // Resources are automatically freed when $msg goes out of scope
    // Or manually call: $msg->free();
} catch (FFireException $e) {
    echo "Error: " . $e->getMessage() . "\n";
}
```

## API

### `Message`

**`static function decode(string $data): Message`**

Decode a `Message` from binary data.

- **Parameter:** `$data` - Binary data (string)
- **Returns:** `Message` object
- **Throws:** `FFireException` if decoding fails

**`function encode(): string`**

Encode this `Message` to binary data.

- **Returns:** Binary data (string)
- **Throws:** `FFireException` if encoding fails

**`function free(): void`**

Manually free the native resources. Called automatically by destructor.

## Error Handling

The library throws `FFireException` for all errors:

```php
try {
    $msg = Message::decode($invalidData);
} catch (FFireException $e) {
    echo "Decoding failed: " . $e->getMessage();
}
```

## Platform Support

This package includes pre-compiled libraries for:

- macOS (Darwin): `libffire.dylib`
- Linux: `libffire.so`
- Windows: `ffire.dll`

The correct library is automatically loaded based on your platform.

## Memory Management

Resources are automatically freed when objects are garbage collected. You can also manually call `free()` if needed for immediate cleanup.

## FFI Extension

This library requires PHP's FFI extension, which provides a way to call C functions from PHP. Make sure it's enabled in your php.ini:

```bash
php -m | grep FFI
```

If FFI is not listed, enable it in php.ini and restart PHP.

## License

Generated by FFire. See your schema's license for terms.
